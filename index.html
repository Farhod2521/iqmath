<script>
  confirmBtn.addEventListener('click', function () {
  // alert('Test yakunlandi!');
  // hideModal();
  
  // Fetch saved answers from localStorage
  const savedAnswers = JSON.parse(localStorage.getItem('answers')) || [];
  
  // Test vaqtini hisoblash
  const startTime = parseInt(localStorage.getItem('startTime') || '0', 10);
  const currentTime = Math.floor(Date.now() / 1000);
  const testTime = currentTime - startTime; // Testning o'tgan vaqti (sekundlarda)
  
  // Prepare data for posting
  const data = {
      "answers": Object.keys(savedAnswers).map(index => {
          const questionId = savedAnswers[index].id;  // Getting item.id from savedAnswers instead of index + 1
          return {
              "quiz_id": questionId,
              "answer": savedAnswers[index].answer
          };
      }),
      "random_score": {},  // Add random_score here
      "test_time": testTime  // Use the calculated test time
  };

  // Random score calculations for correct and incorrect answers
  const randomScore = {
      "savol_raqami_togri": [],
      "savol_raqami_natogri": []
  };

  savedAnswers.forEach((answer, index) => {
      const questionId = answer.id;
      const savolCount = index + 1;  // Savol raqami

      // Assume that we have a method to check if the answer is correct or not
      if (isCorrectAnswer(answer.answer, questionId)) {
          randomScore.savol_raqami_togri.push({
              "savol_count": savolCount,
              "questionId": questionId
          });
      } else {
          randomScore.savol_raqami_natogri.push({
              "savol_count": savolCount,
              "questionId": questionId
          });
      }
  });

  data.random_score = randomScore;

  // Post the data to the API
  fetch('https://jetmind.uz/api/v1/quiz/submit-quiz-result/', {
      method: 'POST',
      headers: headers,
      body: JSON.stringify(data)
  })
  .then(response => response.json())
  .then(result => {
      console.log('Success:', result);
  })
  .catch(error => {
      console.error('Error:', error);
  });
});

</script>