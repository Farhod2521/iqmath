{% extends "base_teacher.html" %}
{% load static %}
{% block content %}



<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.dataTables.min.css">

<div class="modal fade" id="samedata-modal" tabindex="-1" aria-labelledby="exampleModalLabel1">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header d-flex align-items-center">
                <h4 class="modal-title" id="exampleModalLabel1">Savolni Kiriting:</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form>
                    <!-- Savol matni (question) -->
                    <div class="mb-3">
                        <label for="question" class="form-label">Savol</label>
                        <textarea class="form-control rich-editor" id="question" rows="3"></textarea>
                    </div>
                
                    <!-- Javoblar (A, B, C, D) -->
                    <div class="mb-3">
                        <label for="option-a" class="form-label">Javob A</label>
                        <textarea class="form-control rich-editor" id="option-a" rows="2"></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="option-b" class="form-label">Javob B</label>
                        <textarea class="form-control rich-editor" id="option-b" rows="2"></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="option-c" class="form-label">Javob C</label>
                        <textarea class="form-control rich-editor" id="option-c" rows="2"></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="option-d" class="form-label">Javob D</label>
                        <textarea class="form-control rich-editor" id="option-d" rows="2"></textarea>
                    </div>
                
                    <!-- To'g'ri javobni tanlash (answer) -->
                    <div class="mb-3">
                        <label for="correct-answer" class="form-label">To'g'ri javob</label>
                        <select class="form-select" id="correct-answer">
                            <option value="" disabled selected>To'g'ri javobni tanlang</option>
                            <option value="A">A</option>
                            <option value="B">B</option>
                            <option value="C">C</option>
                            <option value="D">D</option>
                        </select>
                    </div>
                
                    <!-- Ball (score) -->
                    <div class="mb-3">
                        <label for="score" class="form-label">Ball</label>
                        <input type="number" class="form-control" id="score" placeholder="Ballni kiriting" step="0.1">
                    </div>
                
                    <!-- Yuborish tugmasi -->
                    <div class="text-end">
                        <button type="button" class="btn btn-success">Saqlash</button>
                    </div>
                </form>
                
            </div>
      
        </div>
    </div>
</div>


      <div class="body-wrapper">
        <div class="container">
          <div class="row">
       
   
            <div class="card">
                <div class="card-body">
                  <div class="mb-2">
                    <h4 class="card-title mb-0">Matimatika savolar</h4>
                  </div>
           
                  <div class="table-responsive">
                    <table id="file_export" class="table w-100 table-striped table-bordered display text-nowrap">
                        <thead>
                            <tr>
                                <th>â„–</th>
                                <th>Savol</th>
                                <th>Javob</th>
                                <th>Ball</th>
                            </tr>
                        </thead>
                        <tbody id="questions-list">
                            <!-- API orqali to'ldiriladi -->
                        </tbody>
                    </table>
                  </div>
                </div>
              </div>
      
        </div>
        
        
        </div>
      </div>

      <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

      <!-- Bootstrap JS -->
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
      <!-- DataTables JS -->
      <script src="https://cdn.datatables.net/1.13.5/js/jquery.dataTables.min.js"></script>
      <script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
      <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>
      <script src="https://cdn.ckeditor.com/4.21.0/standard/ckeditor.js"></script>
      <script>




document.querySelector('.btn-success').addEventListener('click', function() {
    // CKEditor orqali kiritilgan matnlarni olish
    var question = CKEDITOR.instances['question'].getData();
    var optionA = CKEDITOR.instances['option-a'].getData();
    var optionB = CKEDITOR.instances['option-b'].getData();
    var optionC = CKEDITOR.instances['option-c'].getData();
    var optionD = CKEDITOR.instances['option-d'].getData();
    var correctAnswer = document.getElementById('correct-answer').value;
    var score = document.getElementById('score').value;

    var data = {
        "science": 1,  // o'zgarmas qiymat
        "question": question, // CKEditor orqali olingan savol
        "A": optionA, // CKEditor orqali olingan javob A
        "B": optionB, // CKEditor orqali olingan javob B
        "C": optionC, // CKEditor orqali olingan javob C
        "D": optionD, // CKEditor orqali olingan javob D
        "answer": correctAnswer,
        "score": parseFloat(score),  // ballni float turida
        "grade": "10"  // o'zgarmas qiymat
    };

    fetch('https://jetmind.uz/api/v1/quiz/quiz/add/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(data => {
        window.location.reload(); // Muvaffaqiyatli so'rovdan so'ng sahifani yangilash
    })
    .catch(error => {
        console.error('Xato:', error);
        alert('Xato yuz berdi. Iltimos, qayta urinib ko\'ring.');
    });
});
    // CKEditor barcha textarea'lar uchun ulash
// CKEditor barcha textarea'lar uchun ulash
document.addEventListener("DOMContentLoaded", function () {
    const richEditors = document.querySelectorAll(".rich-editor");
    richEditors.forEach((editor) => {
        CKEDITOR.replace(editor.id, {
            // Asosiy vositalar paneli
            toolbar: [
                    // Asosiy formatlash opsiyalari
                    { name: "basicstyles", items: ["Bold", "Italic", "Underline", "Strike", "Subscript", "Superscript", "TextColor", "BGColor"] },
                    
                    // Matnni formatlash va ro'yxatlar
                    { name: "paragraph", items: ["NumberedList", "BulletedList", "-", "Outdent", "Indent", "Blockquote"] },
                    
                    // Kiritish vositalari (rasmlar, jadval va boshqalar)
                    { name: "insert", items: ["Image", "Table", "HorizontalRule", "Smiley", "SpecialChar", "Link", "Unlink"] },
                    
                    // Kodni qo'shish va sintaksisni ta'kidlash
                    { name: "codesnippet", items: ["CodeSnippet"] },
                    
                    // MathJax formulalari qo'shish
                    { name: "math", items: ["MathJax"] },
                    
                    // Vositalar (ekranni kengaytirish)
                    { name: "tools", items: ["Maximize", "ShowBlocks", "Source", "Undo", "Redo"] },
                    
                    // Imlo tekshiruvi
                    { name: "spellchecker", items: ["SpellChecker"] },

                    // HTML ko'rinishini ko'rsatish
                    { name: "editing", items: ["Find", "Replace"] },

                    // Matn ranglarini o'zgartirish
                    { name: "colors", items: ["TextColor", "BGColor"] },

                    // Xususiy belgilarning qo'shilishi
                    { name: "insert", items: ["SpecialChar"] }
                ],
            // Matnning maksimal balandligi
            height: 200,
            // Resurslarni optimallashtirish
            removePlugins: 'elementspath,notification',
            // Maksimal ruxsat berilgan ko'rinish
            maxLength: 1000,
            // O'zgartirilgan matnni saqlash
            autoSave: {
                delay: 3000,
                saveDetectionSelectors: '.cke_save'
            },
            // Ogohlantirishni yashirish
            on: {
                instanceReady: function(evt) {
                    var editor = evt.editor;
                    // CKEditor ogohlantirishlarini yashirish
                    editor.container.find('.cke_warning').hide();
                }
            }
        });
    });
});

    CKEDITOR.on('instanceReady', function(evt) {
    var editor = evt.editor;
    editor.container.find('.cke_warning').hide();
});


      document.addEventListener("DOMContentLoaded", function () {
    const apiBaseUrl = "https://jetmind.uz/api/v1/quiz/quizzes/";
    const questionsListContainer = document.getElementById("questions-list");
    const urlParams = new URLSearchParams(window.location.search);
    const quizId = urlParams.get("id");

    if (quizId) {
        fetch(apiBaseUrl + `${quizId}/`)
            .then((response) => response.json())
            .then((data) => {
                if ($.fn.DataTable.isDataTable("#file_export")) {
                    $("#file_export").DataTable().clear().destroy();
                }

                questionsListContainer.innerHTML = ""; // Clear existing rows
                data.forEach((question, index) => {
                    const questionRow = `
                        <tr>
                            <td>${index + 1}</td>
                            <td>${question.question}</td>
                            <td>${question.answer}</td>
                            <td>${question.score}</td>
                        </tr>
                    `;
                    questionsListContainer.insertAdjacentHTML("beforeend", questionRow);
                });

                // Initialize DataTable with Excel export
                $("#file_export").DataTable({
                    dom: "Bfrtip",
                    buttons: [
               
                        {
                    text: "Savol qo'shish",
                    className: "btn btn-outline-success",
                    action: function () {
                        $("#samedata-modal").modal("show");
                    },
                     },
                    ],
                    pageLength: 10,
                    destroy: true,
                });
            })
            .catch((error) => console.error("Error fetching questions:", error));
    } else {
        questionsListContainer.innerHTML = `
            <tr>
                <td colspan="4" class="text-center">Quiz ID topilmadi!</td>
            </tr>
        `;
    }
});
</script>
{% endblock content %}